.screenplay,
.screenplay-toc {
	--screenplay-font: "Courier Prime";
	--bold-weight: 600;
	--max-width: 61ch;
	--synopsis-margin: 2ch;
	font-family:
		var(--screenplay-font), "Courier Final Draft", "Courier",
		var(--font-monospace);
	--font-text:
		var(--screenplay-font), "Courier Final Draft", "Courier",
		var(--font-monospace);
	--font-preview-view:
		var(--screenplay-font), "Courier Final Draft", "Courier",
		var(--font-monospace);
	--h1-font: var(--screenplay-font);
	--h2-font: var(--screenplay-font);
	--h3-font: var(--screenplay-font);
	--h4-font: var(--screenplay-font);
	--h5-font: var(--screenplay-font);
	--h6-font: var(--screenplay-font);
	--file-margins: 1in 1in 1in 1.5in;
	--file-line-width: 6.2in !important;
	--font-text: var(--screenplay-font);
	font-size: 12pt;
	line-height: 1.1;
	padding: 0;
	margin: 0em auto;
	max-width: var(--max-width);
	overflow-wrap: break-word;
	word-break: normal;
}

.screenplay-snippets .snippet {
	border: 1px solid var(--background-modifier-border);
	border-radius: var(--radius-m);
	zoom: 0.5;
	margin-bottom: 10px;
	max-height: 5.5em; /* Limit to roughly 5 lines (5 × 1.1em line-height) */
	min-height: 3.3em;
	overflow: hidden;
	position: relative;
	background-color: var(--background-secondary-alt);
	transition: max-height 0.3s ease-in-out;
}

.screenplay-snippets .snippet:hover {
	max-height: none;
}

.screenplay-snippets .snippet .screenplay {
	margin: 0; /* Remove auto centering for snippets */
	max-width: none; /* Allow content to fit in scaled container */
}

.screenplay-snippets .snippets-instruction {
	font-size: var(--font-ui-smaller);
	color: var(--text-muted);
	text-align: center;
	padding: var(--size-4-2) var(--size-4-1);
	font-style: italic;
	margin-bottom: var(--size-4-2);
}

/* Split layout for sidebar */
.sidebar-container {
	display: flex;
	flex-direction: column;
	height: 100%;
}

.toc-section {
	flex: 1 1 60%; /* Take up to 50% of space */
	min-height: 200px; /* Minimum guaranteed space */
	overflow-y: auto;
	border-bottom: 1px solid var(--background-modifier-border);
	padding-bottom: 10px;
}

.snippets-section {
	flex: 1 1 40%;
	min-height: 200px;
	overflow-y: auto;
	padding-top: 10px;
}

.screenplay:not(.is-phone) {
	width: var(--max-width);
	min-width: var(--max-width);
}

.is-phone .screenplay {
	width: fit-content;
	min-width: fit-content;
}

/**************** dialogue */

.screenplay .dual-dialogue-character {
	text-align: left;
	text-transform: uppercase;
	color: var(--h2-color);
	font-weight: var(--bold-weight);
	font-size: inherit;
	width: fit-content;
	margin-left: 1.1in;
	margin-bottom: 0;
	padding: 0px;
}

.screenplay .dialogue-character {
	text-transform: uppercase;
	color: var(--h2-color);
	font-weight: var(--bold-weight);
	font-size: inherit;
	padding: 0 0 0 2.5in;
	margin: 0;
	width: fit-content;
	break-after: avoid-page;
	text-align: left;
}

.screenplay .dialogue-words {
	display: block;
	text-align: left;
	width: 34ch;
	max-width: 34ch;
	margin-top: 0;
	margin-bottom: 0;
	margin-right: 0;
	margin-left: 1.5in;
	padding: 0px;
	break-before: avoid-page;
}

/* On the phone we don't need number of lines on the screen to
   match those of the printed product. We just need something
   readable where a human still visually recognises what is what.
   So let's center it (margin 0 auto) and don't do the padding */
.is-phone .screenplay .dialogue-character {
	padding: 0.1in 0 0 0;
	margin: 0 auto;
}

.is-phone .screenplay .dialogue-words {
	margin: 0.5in;
	width: calc(100% - 1in);
	max-width: calc(100% - 1in);
}

/* prevents  a page break from interrupting dialogue */
.screenplay .dialogue {
	break-inside: avoid;
}

/* adjust for mobile */
.is-phone .screenplay .dialogue-words {
	margin: 0 0 0 0.45in;
}

/* parentheticals */
.screenplay .dialogue-parenthetical {
	margin: 0 0 0 1.91in;
	padding: 0px;
	text-align: left;
	font-style: italic;
}

/* adjust for phones */
.is-phone .screenplay .dialogue-parenthetical {
	margin: 0 0 0 0.8in;
}

/****** scene headings */

.screenplay .scene-heading-container {
	position: relative;
	display: flex;
	align-items: center;
	margin: 1em 0;
}

.screenplay .scene-heading,
.screenplay-toc .scene-heading {
	padding: 0px !important;
	text-transform: uppercase;
	font-weight: var(--bold-weight);
	font-size: inherit;
	text-align: left;
	color: var(--h1-color);
	flex-grow: 1;
	margin: 0;
}

.screenplay .scene-number-left {
	font-weight: bold;
	margin-right: 1em;
	color: var(--h1-color);
}

.screenplay .scene-number-right {
	font-weight: bold;
	margin-left: 1em;
	color: var(--h1-color);
}

.screenplay .transition {
	display: block;
	padding: 0px;
	text-transform: uppercase;
	color: var(--h3-color);
	font-weight: var(--bold-weight);
	font-size: inherit;
	text-align: right;
}

.screenplay h1,
.screenplay h2,
.screenplay h3,
.screenplay h4,
.screenplay h5,
.screenplay-toc h1,
.screenplay-toc h2,
.screenplay-toc h3,
.screenplay-toc h4,
.screenplay-toc h5 {
	font-size: inherit;
	text-align: left;
	text-transform: uppercase;
	font-weight: var(--bold-weight);
	margin: 0;
}

/********* sections */

.screenplay .section,
.screenplay-toc .section {
	text-transform: uppercase;
	font-weight: var(--bold-weight);
	text-align: left;
}

/********* synopsis and notes */

.screenplay .synopsis {
	color: var(--text-muted);
	font-style: italic;
	margin-left: var(--synopsis-margin);
	margin-right: var(--synopsis-margin);
	background-color: var(--background-primary-alt);
}

.screenplay .lyrics {
	font-style: italic;
}

.screenplay-toc .synopsis {
	color: var(--text-muted);
	font-style: italic;
	margin-left: var(--synopsis-margin);
	margin-right: var(--synopsis-margin);
	background-color: var(--background-primary-alt);
	font-size: 11px;
}

.screenplay .boneyard {
	color: var(--text-faint);
	font-style: italic;
}

/********* centered text */

.screenplay .centered {
	text-align: center;
	display: block;
}

/******** text decoration */

.screenplay .bold {
	font-weight: bold;
}

.screenplay .italics {
	font-style: italic;
}

.screenplay .underline {
	text-decoration: underline;
}

.screenplay .note-symbol-minus {
	text-decoration: line-through;
	color: var(--color-red);
}

.screenplay .note-symbol-plus {
	color: var(--color-green);
}

.screenplay .note-todo,
.screenplay-toc .note-todo {
	color: var(--text-muted);
	font-style: italic;
	background-image: linear-gradient(
		transparent 70%,
		rgba(243, 245, 39, 0.4) 70%
	);
}

.screenplay-toc .note-todo {
	font-size: 10pt;
	margin-left: 20px;
}

.screenplay-toc .toc-controls {
	display: flex;
	flex-direction: row;
	flex-wrap: nowrap;
	align-items: center;
	padding: 4px;
	gap: 4px;
}

.screenplay .note {
	color: var(--text-muted);
	font-style: italic;
	background-color: rgba(var(--background-modifier-info-rgb), 0.3);
}

/* Margin note styling in editor view */
.screenplay .cm-line .note-margin-editor {
	color: var(--text-accent);
	font-style: normal;
	background: rgba(var(--background-modifier-accent-rgb), 0.2);
	border-radius: 3px;
	padding: 0 2px;
}

.screenplay .note-margin {
	position: absolute;
	left: calc(100% + 2ch);
	width: 8ch;
	color: var(--text-muted);
	font-size: 0.9em;
	font-style: normal;
	background: none;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	text-transform: uppercase;
}

/* Parent needs relative positioning for margin notes */
.screenplay .action,
.screenplay .lyrics {
	position: relative;
}

/* Dialogue words need special handling for margin marks */
.screenplay .dialogue-words {
	position: relative;
}

/* Align dialogue margin marks with action margin marks */
/* Action is 61ch wide, dialogue-words is 34ch wide + 1.5in margin (≈15ch),
   in the end we experimentally determined that 16ch + 3pt works out just right */
.screenplay .dialogue-words .note-margin {
	left: calc(100% + 16ch + 3pt);
}

.screenplay .blackout {
	background-color: rgba(0, 0, 0, 0.85);
	color: transparent;
	border-radius: 2px;
	padding: 0 2px;
	user-select: none;
}

/**************** page break */
/* For now we generate hr in the reading view, so this
   is specific to the editor */

.screenplay .cm-line .page-break {
	background: linear-gradient(
		0deg,
		transparent 45%,
		var(--text-faint) 45%,
		var(--text-faint) 55%,
		transparent 55%
	);
	display: inline-block;
	width: 100%;
}

.screenplay .cm-cursorLayer .cm-cursor {
	border-left: 3.2px solid var(--caret-color);
	margin-left: -1.6px;
}

.screenplay .cm-selectionLayer .cm-selectionBackground {
	background-color: var(--text-selection);
}

.screenplay.cm-editor:focus,
.cm-editor.cm-focused {
	outline: none !important;
	outline-offset: 0 !important;
}

/****************************** index view */

.screenplay-index-cards {
	display: grid;
	grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
	gap: 10px;
	--font-text: var(--screenplay-font);
}

.screenplay-index-card {
	border: 1px solid #ccc;
	padding: 10px;
	height: 160px;
	background-color: var(--background-primary-alt);
	border-radius: 8px;
	overflow: hidden;
	position: relative;
	display: flex;
	flex-direction: column;
}

.screenplay-index-card.dashed {
	border: 1px dashed #ccc;
}

.show-on-hover {
	opacity: 0;
	transition: opacity 0.2s ease-in-out;
}

.show-on-hover:hover {
	opacity: 1;
}

.index-card-buttons {
	position: absolute;
	top: 10px;
	right: 10px;
	padding: 0;
}

.screenplay-index-cards .drop-right {
	transform: translate(-5px);
	background-color: var(--background-modifier-hover);
}

.screenplay-index-cards .drop-left {
	transform: translate(5px);
	background-color: var(--background-modifier-hover);
}

.screenplay-index-card .scene-heading {
	font-size: 14px;
	text-transform: uppercase;
	font-family:
		var(--screenplay-font), "Courier Final Draft", "Courier",
		var(--font-monospace);
	margin-top: 0;
	margin-left: 0;
	margin-right: 0;
	margin-bottom: 8px;
	/* padding: 8px; */
}

.screenplay-index-card .synopsis {
	font-size: 11px;
	/* padding: 8px; */
}

.screenplay-index-card textarea {
	font-size: 11px;
	flex: 1;
	resize: none;
}

.screenplay-index-card .edit-buttons {
	margin-top: 4px;
	margin-bottom: 0;
	justify-content: flex-end;
	display: flex;
	gap: 10px;
}

.screenplay-index-card .note-todo {
	font-size: 11px;
	margin: 5px;
	background-image: linear-gradient(
		transparent 70%,
		rgba(243, 245, 39, 0.4) 70%
	);
}

/* PDF Options Dialog */
.pdf-warning {
	background-color: var(--background-modifier-error);
	border-radius: 4px;
	padding: 0.5rem;
	margin-bottom: 1rem;
}

.pdf-warning-text {
	color: var(--text-error);
	font-weight: 500;
	margin: 0 0 0.25rem 0;
}

.pdf-warning-path {
	font-family: var(--font-monospace);
	font-size: 0.9em;
	color: var(--text-muted);
	margin: 0;
	word-break: break-all;
}

/* Drag and Drop Support for Existing Snippets */
.screenplay-snippets .snippet[draggable="true"] {
	cursor: grab;
}

.screenplay-snippets .snippet[draggable="true"]:active {
	cursor: grabbing;
}

/* Tooltip-based Snip Button Styling */
.cm-tooltip-snip {
	background: var(--interactive-accent) !important;
	color: var(--text-on-accent) !important;
	border: none !important;
	padding: 6px 12px !important;
	border-radius: 4px !important;
	font-size: 12px !important;
	font-weight: 500 !important;
	cursor: pointer !important;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
	transition: all 0.2s ease !important;
	margin: 0 !important;
}

.cm-tooltip-snip:hover {
	background: var(--interactive-accent-hover) !important;
	transform: translateY(-1px) !important;
	box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15) !important;
}

.cm-tooltip-snip:active {
	transform: translateY(0) !important;
	box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;
}

.screenplay-snippets .snippet:hover {
	border-color: var(--interactive-accent);
}

.screenplay-snippets .snippet-more {
	text-align: center;
	color: var(--text-muted);
	font-style: italic;
	font-size: 0.9em;
	margin-top: 0.25rem;
}

/* Folding support */

.screenplay .cm-gutters {
	background-color: transparent;
	border-right-color: transparent;
}

.screenplay .cm-foldGutter {
	width: 16px;
	padding: 0 2px;
	background: transparent;
	color: var(--text-muted);
	cursor: pointer;
}

.screenplay .cm-foldGutter span {
	color: var(--text-faint);
}

.screenplay .cm-foldGutter span:hover {
	color: var(--text-normal);
}

.screenplay .cm-foldGutter:hover {
	color: var(--text-normal);
}

.screenplay .cm-foldPlaceholder {
	background: var(--background-modifier-border);
	color: var(--text-muted);
	border: 1px solid var(--background-modifier-border-hover);
	border-radius: 3px;
	padding: 0 4px;
	margin: 0 2px;
	font-size: 0.8em;
	cursor: pointer;
}

.screenplay .cm-foldPlaceholder:hover {
	background: var(--background-modifier-hover);
	color: var(--text-normal);
}
